(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{735:function(s,t,a){"use strict";a.r(t);var n=a(5),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[s._v("è¯´æ˜")]),s._v(" "),a("p",[s._v("åœ¨è®¡ç®—æœºæ€§èƒ½è°ƒè¯•é¢†åŸŸé‡Œï¼Œprofiling æ˜¯æŒ‡å¯¹åº”ç”¨ç¨‹åºçš„ç”»åƒï¼Œç”»åƒå°±æ˜¯åº”ç”¨ç¨‹åºä½¿ç”¨ CPU å’Œå†…å­˜çš„æƒ…å†µã€‚ Goè¯­è¨€æ˜¯ä¸€ä¸ªå¯¹æ€§èƒ½ç‰¹åˆ«çœ‹é‡çš„è¯­è¨€ï¼Œå› æ­¤è¯­è¨€ä¸­è‡ªå¸¦äº† profiling çš„åº“ï¼Œè¿™ç¯‡æ–‡ç« å°±è¦è®²è§£æ€ä¹ˆåœ¨ golang ä¸­åš profilingã€‚")])]),s._v(" "),a("h2",{attrs:{id:"goæ€§èƒ½ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#goæ€§èƒ½ä¼˜åŒ–"}},[s._v("#")]),s._v(" Goæ€§èƒ½ä¼˜åŒ–")]),s._v(" "),a("p",[s._v("Goè¯­è¨€é¡¹ç›®ä¸­çš„æ€§èƒ½ä¼˜åŒ–ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("CPU profileï¼šæŠ¥å‘Šç¨‹åºçš„ CPU ä½¿ç”¨æƒ…å†µï¼ŒæŒ‰ç…§ä¸€å®šé¢‘ç‡å»é‡‡é›†åº”ç”¨ç¨‹åºåœ¨ CPU å’Œå¯„å­˜å™¨ä¸Šé¢çš„æ•°æ®")]),s._v(" "),a("li",[s._v("Memory Profileï¼ˆHeap Profileï¼‰ï¼šæŠ¥å‘Šç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ")]),s._v(" "),a("li",[s._v("Block Profilingï¼šæŠ¥å‘Š goroutines ä¸åœ¨è¿è¡ŒçŠ¶æ€çš„æƒ…å†µï¼Œå¯ä»¥ç”¨æ¥åˆ†æå’ŒæŸ¥æ‰¾æ­»é”ç­‰æ€§èƒ½ç“¶é¢ˆ")]),s._v(" "),a("li",[s._v("Goroutine Profilingï¼šæŠ¥å‘Š goroutines çš„ä½¿ç”¨æƒ…å†µï¼Œæœ‰å“ªäº› goroutineï¼Œå®ƒä»¬çš„è°ƒç”¨å…³ç³»æ˜¯æ€æ ·çš„")])]),s._v(" "),a("h2",{attrs:{id:"é‡‡é›†æ€§èƒ½æ•°æ®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é‡‡é›†æ€§èƒ½æ•°æ®"}},[s._v("#")]),s._v(" é‡‡é›†æ€§èƒ½æ•°æ®")]),s._v(" "),a("p",[s._v("Goè¯­è¨€å†…ç½®äº†è·å–ç¨‹åºçš„è¿è¡Œæ•°æ®çš„å·¥å…·ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸¤ä¸ªæ ‡å‡†åº“ï¼š")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("runtime/pprof")]),s._v("ï¼šé‡‡é›†å·¥å…·å‹åº”ç”¨è¿è¡Œæ•°æ®è¿›è¡Œåˆ†æ")]),s._v(" "),a("li",[a("code",[s._v("net/http/pprof")]),s._v("ï¼šé‡‡é›†æœåŠ¡å‹åº”ç”¨è¿è¡Œæ—¶æ•°æ®è¿›è¡Œåˆ†æ")])]),s._v(" "),a("p",[s._v("pprofå¼€å¯åï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆ10msï¼‰å°±ä¼šæ”¶é›†ä¸‹å½“å‰çš„å †æ ˆä¿¡æ¯ï¼Œè·å–å„ä¸ªå‡½æ•°å ç”¨çš„CPUä»¥åŠå†…å­˜èµ„æºï¼›æœ€åé€šè¿‡å¯¹è¿™äº›é‡‡æ ·æ•°æ®è¿›è¡Œåˆ†æï¼Œå½¢æˆä¸€ä¸ªæ€§èƒ½åˆ†ææŠ¥å‘Šã€‚")]),s._v(" "),a("p",[s._v("æ³¨æ„ï¼Œæˆ‘ä»¬åªåº”è¯¥åœ¨æ€§èƒ½æµ‹è¯•çš„æ—¶å€™æ‰åœ¨ä»£ç ä¸­å¼•å…¥pprofã€‚")]),s._v(" "),a("h2",{attrs:{id:"å·¥å…·å‹åº”ç”¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å·¥å…·å‹åº”ç”¨"}},[s._v("#")]),s._v(" å·¥å…·å‹åº”ç”¨")]),s._v(" "),a("p",[s._v("å¦‚æœä½ çš„åº”ç”¨ç¨‹åºæ˜¯è¿è¡Œä¸€æ®µæ—¶é—´å°±ç»“æŸé€€å‡ºç±»å‹ã€‚é‚£ä¹ˆæœ€å¥½çš„åŠæ³•æ˜¯åœ¨åº”ç”¨é€€å‡ºçš„æ—¶å€™æŠŠ profiling çš„æŠ¥å‘Šä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œè¿›è¡Œåˆ†æã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨"),a("code",[s._v("runtime/pprof")]),s._v("åº“ã€‚ é¦–å…ˆåœ¨ä»£ç ä¸­å¯¼å…¥"),a("code",[s._v("runtime/pprof")]),s._v("å·¥å…·ï¼š")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"runtime/pprof"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"cpuæ€§èƒ½åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cpuæ€§èƒ½åˆ†æ"}},[s._v("#")]),s._v(" CPUæ€§èƒ½åˆ†æ")]),s._v(" "),a("p",[s._v("å¼€å¯CPUæ€§èƒ½åˆ†æï¼š")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[s._v("pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("StartCPUProfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Writer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("åœæ­¢CPUæ€§èƒ½åˆ†æï¼š")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[s._v("pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("StopCPUProfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("åº”ç”¨æ‰§è¡Œç»“æŸåï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œä¿å­˜äº†æˆ‘ä»¬çš„ CPU profiling æ•°æ®ã€‚å¾—åˆ°é‡‡æ ·æ•°æ®ä¹‹åï¼Œä½¿ç”¨"),a("code",[s._v("go tool pprof")]),s._v("å·¥å…·è¿›è¡ŒCPUæ€§èƒ½åˆ†æã€‚")]),s._v(" "),a("h3",{attrs:{id:"å†…å­˜æ€§èƒ½ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å†…å­˜æ€§èƒ½ä¼˜åŒ–"}},[s._v("#")]),s._v(" å†…å­˜æ€§èƒ½ä¼˜åŒ–")]),s._v(" "),a("p",[s._v("è®°å½•ç¨‹åºçš„å †æ ˆä¿¡æ¯")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[s._v("pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("WriteHeapProfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Writer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å¾—åˆ°é‡‡æ ·æ•°æ®ä¹‹åï¼Œä½¿ç”¨"),a("code",[s._v("go tool pprof")]),s._v("å·¥å…·è¿›è¡Œå†…å­˜æ€§èƒ½åˆ†æã€‚")]),s._v(" "),a("p",[a("code",[s._v("go tool pprof")]),s._v("é»˜è®¤æ˜¯ä½¿ç”¨"),a("code",[s._v("-inuse_space")]),s._v("è¿›è¡Œç»Ÿè®¡ï¼Œè¿˜å¯ä»¥ä½¿ç”¨"),a("code",[s._v("-inuse-objects")]),s._v("æŸ¥çœ‹åˆ†é…å¯¹è±¡çš„æ•°é‡ã€‚")]),s._v(" "),a("h2",{attrs:{id:"æœåŠ¡å‹åº”ç”¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æœåŠ¡å‹åº”ç”¨"}},[s._v("#")]),s._v(" æœåŠ¡å‹åº”ç”¨")]),s._v(" "),a("p",[s._v("å¦‚æœä½ çš„åº”ç”¨ç¨‹åºæ˜¯ä¸€ç›´è¿è¡Œçš„ï¼Œæ¯”å¦‚ web åº”ç”¨ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨"),a("code",[s._v("net/http/pprof")]),s._v("åº“ï¼Œå®ƒèƒ½å¤Ÿåœ¨æä¾› HTTP æœåŠ¡è¿›è¡Œåˆ†æã€‚")]),s._v(" "),a("p",[s._v("å¦‚æœä½¿ç”¨äº†é»˜è®¤çš„"),a("code",[s._v("http.DefaultServeMux")]),s._v("ï¼ˆé€šå¸¸æ˜¯ä»£ç ç›´æ¥ä½¿ç”¨ http.ListenAndServe(â€œ0.0.0.0:8000â€, nil)ï¼‰ï¼Œåªéœ€è¦åœ¨ä½ çš„web serverç«¯ä»£ç ä¸­æŒ‰å¦‚ä¸‹æ–¹å¼å¯¼å…¥"),a("code",[s._v("net/http/pprof")])]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("_")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net/http/pprof"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å¦‚æœä½ ä½¿ç”¨è‡ªå®šä¹‰çš„ Muxï¼Œåˆ™éœ€è¦æ‰‹åŠ¨æ³¨å†Œä¸€äº›è·¯ç”±è§„åˆ™ï¼š")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[s._v("r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("HandleFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/debug/pprof/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("HandleFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/debug/pprof/cmdline"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Cmdline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("HandleFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/debug/pprof/profile"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Profile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("HandleFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/debug/pprof/symbol"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Symbol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("HandleFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/debug/pprof/trace"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Trace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ginæ¡†æ¶ï¼Œé‚£ä¹ˆæ¨èä½¿ç”¨"),a("a",{attrs:{href:"https://github.com/gin-contrib/pprof",target:"_blank",rel:"noopener noreferrer"}},[s._v("github.com/gin-contrib/pprof"),a("OutboundLink")],1),s._v("ï¼Œåœ¨ä»£ç ä¸­é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ³¨å†Œpprofç›¸å…³è·¯ç”±ã€‚")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[s._v("pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Register")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ä¸ç®¡å“ªç§æ–¹å¼ï¼Œä½ çš„ HTTP æœåŠ¡éƒ½ä¼šå¤šå‡º"),a("code",[s._v("/debug/pprof")]),s._v(" endpointï¼Œè®¿é—®å®ƒä¼šå¾—åˆ°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹ï¼š"),a("img",{attrs:{src:"assets/pprof2.png",alt:"debug/pprof"}}),s._v("è¿™ä¸ªè·¯å¾„ä¸‹è¿˜æœ‰å‡ ä¸ªå­é¡µé¢ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("/debug/pprof/profileï¼šè®¿é—®è¿™ä¸ªé“¾æ¥ä¼šè‡ªåŠ¨è¿›è¡Œ CPU profilingï¼ŒæŒç»­ 30sï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ä¾›ä¸‹è½½")]),s._v(" "),a("li",[s._v("/debug/pprof/heapï¼š Memory Profiling çš„è·¯å¾„ï¼Œè®¿é—®è¿™ä¸ªé“¾æ¥ä¼šå¾—åˆ°ä¸€ä¸ªå†…å­˜ Profiling ç»“æœçš„æ–‡ä»¶")]),s._v(" "),a("li",[s._v("/debug/pprof/blockï¼šblock Profiling çš„è·¯å¾„")]),s._v(" "),a("li",[s._v("/debug/pprof/goroutinesï¼šè¿è¡Œçš„ goroutines åˆ—è¡¨ï¼Œä»¥åŠè°ƒç”¨å…³ç³»")])]),s._v(" "),a("h2",{attrs:{id:"go-tool-pprofå‘½ä»¤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#go-tool-pprofå‘½ä»¤"}},[s._v("#")]),s._v(" go tool pprofå‘½ä»¤")]),s._v(" "),a("p",[s._v("ä¸ç®¡æ˜¯å·¥å…·å‹åº”ç”¨è¿˜æ˜¯æœåŠ¡å‹åº”ç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ç›¸åº”çš„pprofåº“è·å–æ•°æ®ä¹‹åï¼Œä¸‹ä¸€æ­¥çš„éƒ½è¦å¯¹è¿™äº›æ•°æ®è¿›è¡Œåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨"),a("code",[s._v("go tool pprof")]),s._v("å‘½ä»¤è¡Œå·¥å…·ã€‚")]),s._v(" "),a("p",[a("code",[s._v("go tool pprof")]),s._v("æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ä¸º:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("go tool pprof "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("binary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å…¶ä¸­ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("binary æ˜¯åº”ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨æ¥è§£æå„ç§ç¬¦å·ï¼›")]),s._v(" "),a("li",[s._v("source è¡¨ç¤º profile æ•°æ®çš„æ¥æºï¼Œå¯ä»¥æ˜¯æœ¬åœ°çš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ http åœ°å€ã€‚")])]),s._v(" "),a("p",[a("strong",[s._v("æ³¨æ„äº‹é¡¹ï¼š")]),s._v(" è·å–çš„ Profiling æ•°æ®æ˜¯åŠ¨æ€çš„ï¼Œè¦æƒ³è·å¾—æœ‰æ•ˆçš„æ•°æ®ï¼Œè¯·ä¿è¯åº”ç”¨å¤„äºè¾ƒå¤§çš„è´Ÿè½½ï¼ˆæ¯”å¦‚æ­£åœ¨ç”Ÿæˆä¸­è¿è¡Œçš„æœåŠ¡ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–å·¥å…·æ¨¡æ‹Ÿè®¿é—®å‹åŠ›ï¼‰ã€‚å¦åˆ™å¦‚æœåº”ç”¨å¤„äºç©ºé—²çŠ¶æ€ï¼Œå¾—åˆ°çš„ç»“æœå¯èƒ½æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚")]),s._v(" "),a("h2",{attrs:{id:"å…·ä½“ç¤ºä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å…·ä½“ç¤ºä¾‹"}},[s._v("#")]),s._v(" å…·ä½“ç¤ºä¾‹")]),s._v(" "),a("p",[s._v("é¦–å…ˆæˆ‘ä»¬æ¥å†™ä¸€æ®µæœ‰é—®é¢˜çš„ä»£ç ï¼š")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// runtime_pprof/main.go")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flag"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fmt"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"os"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"runtime/pprof"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸€æ®µæœ‰é—®é¢˜çš„ä»£ç ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("logicCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" c "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("chan")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" v "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\t\t\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"recv from chan, value:%v\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" isCPUPprof "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bool")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" isMemPprof "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bool")]),s._v("\n\n\tflag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("BoolVar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("isCPUPprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpu"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"turn cpu pprof on"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tflag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("BoolVar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("isMemPprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mem"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"turn mem pprof on"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tflag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" isCPUPprof "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tfile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./cpu.pprof"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create cpu pprof failed, err:%v\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\tpprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("StartCPUProfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("defer")]),s._v(" pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("StopCPUProfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("logicCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\ttime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Second"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" isMemPprof "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tfile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./mem.pprof"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create mem pprof failed, err:%v\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\tpprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("WriteHeapProfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\tfile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br")])]),a("p",[s._v("é€šè¿‡flagæˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤è¡Œæ§åˆ¶æ˜¯å¦å¼€å¯CPUå’ŒMemçš„æ€§èƒ½åˆ†æã€‚ å°†ä¸Šé¢çš„ä»£ç ä¿å­˜å¹¶ç¼–è¯‘æˆ"),a("code",[s._v("runtime_pprof")]),s._v("å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰§è¡Œæ—¶åŠ ä¸Š"),a("code",[s._v("-cpu")]),s._v("å‘½ä»¤è¡Œå‚æ•°å¦‚ä¸‹ï¼š")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./runtime_pprof -cpu\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç­‰å¾…30ç§’åä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª"),a("code",[s._v("cpu.pprof")]),s._v("æ–‡ä»¶ã€‚")]),s._v(" "),a("h3",{attrs:{id:"å‘½ä»¤è¡Œäº¤äº’ç•Œé¢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‘½ä»¤è¡Œäº¤äº’ç•Œé¢"}},[s._v("#")]),s._v(" å‘½ä»¤è¡Œäº¤äº’ç•Œé¢")]),s._v(" "),a("p",[s._v("æˆ‘ä»¬ä½¿ç”¨goå·¥å…·é“¾é‡Œçš„"),a("code",[s._v("pprof")]),s._v("æ¥åˆ†æä¸€ä¸‹ã€‚")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("go tool pprof cpu.pprof\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æ‰§è¡Œä¸Šé¢çš„ä»£ç ä¼šè¿›å…¥äº¤äº’ç•Œé¢å¦‚ä¸‹ï¼š")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("runtime_pprof $ go tool pprof cpu.pprof\nType: cpu\nTime: Jun "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(" at "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":28am "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDuration: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(".13s, Total samples "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".91mins "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("568.60")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEntering interactive mode "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"help"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" commands, "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"o"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("æˆ‘ä»¬å¯ä»¥åœ¨äº¤äº’ç•Œé¢è¾“å…¥"),a("code",[s._v("top3")]),s._v("æ¥æŸ¥çœ‹ç¨‹åºä¸­å ç”¨CPUå‰3ä½çš„å‡½æ•°ï¼š")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" top3\nShowing nodes accounting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(".37s, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("87.68")]),s._v("% of "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114")]),s._v(".47s total\nDropped "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" nodes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cum "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".57s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nShowing "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" nodes out of "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n      flat  flat%   sum%        cum   cum%\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(".52s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37.15")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37.15")]),s._v("%     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("91")]),s._v(".73s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80.13")]),s._v("%  runtime.selectnbrecv\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v(".21s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30.76")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("67.90")]),s._v("%     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v(".49s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("34.50")]),s._v("%  runtime.chanrecv\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(".64s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.78")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("87.68")]),s._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114")]),s._v(".37s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.91")]),s._v("%  main.logicCode\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("å…¶ä¸­ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("flatï¼šå½“å‰å‡½æ•°å ç”¨CPUçš„è€—æ—¶")]),s._v(" "),a("li",[s._v("flatï¼š:å½“å‰å‡½æ•°å ç”¨CPUçš„è€—æ—¶ç™¾åˆ†æ¯”")]),s._v(" "),a("li",[s._v("sun%ï¼šå‡½æ•°å ç”¨CPUçš„è€—æ—¶ç´¯è®¡ç™¾åˆ†æ¯”")]),s._v(" "),a("li",[s._v("cumï¼šå½“å‰å‡½æ•°åŠ ä¸Šè°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°å ç”¨CPUçš„æ€»è€—æ—¶")]),s._v(" "),a("li",[s._v("cum%ï¼šå½“å‰å‡½æ•°åŠ ä¸Šè°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°å ç”¨CPUçš„æ€»è€—æ—¶ç™¾åˆ†æ¯”")]),s._v(" "),a("li",[s._v("æœ€åä¸€åˆ—ï¼šå‡½æ•°åç§°")])]),s._v(" "),a("p",[s._v("åœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†æè¿™äº”åˆ—å¾—å‡ºä¸€ä¸ªåº”ç”¨ç¨‹åºçš„è¿è¡Œæƒ…å†µï¼Œå¹¶å¯¹ç¨‹åºè¿›è¡Œä¼˜åŒ–ã€‚")]),s._v(" "),a("p",[s._v("æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨"),a("code",[s._v("list å‡½æ•°å")]),s._v("å‘½ä»¤æŸ¥çœ‹å…·ä½“çš„å‡½æ•°åˆ†æï¼Œä¾‹å¦‚æ‰§è¡Œ"),a("code",[s._v("list logicCode")]),s._v("æŸ¥çœ‹æˆ‘ä»¬ç¼–å†™çš„å‡½æ•°çš„è¯¦ç»†åˆ†æã€‚")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" list logicCode\nTotal: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".91mins\nROUTINE "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" main.logicCode "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("./runtime_pprof/main.go\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(".64s   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".91mins "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("flat, cum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.91")]),s._v("% of Total\n         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":func "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("logicCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":   var c chan int\n         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":           "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":           "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("v")]),s._v(" :"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-c:\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(".64s   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".91mins     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":                   fmt.Printf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"recv from chan, value:%v'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("v")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":           default:\n         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":\n         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("é€šè¿‡åˆ†æå‘ç°å¤§éƒ¨åˆ†CPUèµ„æºè¢«17è¡Œå ç”¨ï¼Œæˆ‘ä»¬åˆ†æå‡ºselectè¯­å¥ä¸­çš„defaultæ²¡æœ‰å†…å®¹ä¼šå¯¼è‡´ä¸Šé¢çš„"),a("code",[s._v("case v:=<-c:")]),s._v("ä¸€ç›´æ‰§è¡Œã€‚æˆ‘ä»¬åœ¨defaultåˆ†æ”¯æ·»åŠ ä¸€è¡Œ"),a("code",[s._v("time.Sleep(time.Second)")]),s._v("å³å¯ã€‚")]),s._v(" "),a("h3",{attrs:{id:"å›¾å½¢åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å›¾å½¢åŒ–"}},[s._v("#")]),s._v(" å›¾å½¢åŒ–")]),s._v(" "),a("p",[s._v("æˆ–è€…å¯ä»¥ç›´æ¥è¾“å…¥webï¼Œé€šè¿‡svgå›¾çš„æ–¹å¼æŸ¥çœ‹ç¨‹åºä¸­è¯¦ç»†çš„CPUå ç”¨æƒ…å†µã€‚ æƒ³è¦æŸ¥çœ‹å›¾å½¢åŒ–çš„ç•Œé¢é¦–å…ˆéœ€è¦å®‰è£…"),a("a",{attrs:{href:"https://graphviz.gitlab.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("graphviz"),a("OutboundLink")],1),s._v("å›¾å½¢åŒ–å·¥å…·ã€‚")]),s._v(" "),a("p",[s._v("Macï¼š")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("brew "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" graphviz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Windows: ä¸‹è½½"),a("a",{attrs:{href:"https://graphviz.gitlab.io/_pages/Download/Download_windows.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("graphviz"),a("OutboundLink")],1),s._v(" å°†"),a("code",[s._v("graphviz")]),s._v("å®‰è£…ç›®å½•ä¸‹çš„binæ–‡ä»¶å¤¹æ·»åŠ åˆ°Pathç¯å¢ƒå˜é‡ä¸­ã€‚ åœ¨ç»ˆç«¯è¾“å…¥"),a("code",[s._v("dot -version")]),s._v("æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚")]),s._v(" "),a("p",[a("img",{attrs:{src:"assets/cpu_pprof.png",alt:"CPUå æ¯”å›¾"}}),s._v("å…³äºå›¾å½¢çš„è¯´æ˜ï¼š æ¯ä¸ªæ¡†ä»£è¡¨ä¸€ä¸ªå‡½æ•°ï¼Œç†è®ºä¸Šæ¡†çš„è¶Šå¤§è¡¨ç¤ºå ç”¨çš„CPUèµ„æºè¶Šå¤šã€‚ æ–¹æ¡†ä¹‹é—´çš„çº¿æ¡ä»£è¡¨å‡½æ•°ä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€‚ çº¿æ¡ä¸Šçš„æ•°å­—è¡¨ç¤ºå‡½æ•°è°ƒç”¨çš„æ¬¡æ•°ã€‚ æ–¹æ¡†ä¸­çš„ç¬¬ä¸€è¡Œæ•°å­—è¡¨ç¤ºå½“å‰å‡½æ•°å ç”¨CPUçš„ç™¾åˆ†æ¯”ï¼Œç¬¬äºŒè¡Œæ•°å­—è¡¨ç¤ºå½“å‰å‡½æ•°ç´¯è®¡å ç”¨CPUçš„ç™¾åˆ†æ¯”ã€‚")]),s._v(" "),a("p",[s._v("é™¤äº†åˆ†æCPUæ€§èƒ½æ•°æ®ï¼Œpprofä¹Ÿæ”¯æŒåˆ†æå†…å­˜æ€§èƒ½æ•°æ®ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ†æhttpæœåŠ¡çš„heapæ€§èƒ½æ•°æ®ï¼ŒæŸ¥çœ‹å½“å‰ç¨‹åºçš„å†…å­˜å ç”¨ä»¥åŠçƒ­ç‚¹å†…å­˜å¯¹è±¡ä½¿ç”¨çš„æƒ…å†µã€‚")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹å†…å­˜å ç”¨æ•°æ®")]),s._v("\ngo tool pprof -inuse_space http://127.0.0.1:8080/debug/pprof/heap\ngo tool pprof -inuse_objects http://127.0.0.1:8080/debug/pprof/heap\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹ä¸´æ—¶å†…å­˜åˆ†é…æ•°æ®")]),s._v("\ngo tool pprof -alloc_space http://127.0.0.1:8080/debug/pprof/heap\ngo tool pprof -alloc_objects http://127.0.0.1:8080/debug/pprof/heap\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"go-torchå’Œç«ç„°å›¾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#go-torchå’Œç«ç„°å›¾"}},[s._v("#")]),s._v(" go-torchå’Œç«ç„°å›¾")]),s._v(" "),a("p",[s._v("ç«ç„°å›¾ï¼ˆFlame Graphï¼‰æ˜¯ Bredan Gregg åˆ›å»ºçš„ä¸€ç§æ€§èƒ½åˆ†æå›¾è¡¨ï¼Œå› ä¸ºå®ƒçš„æ ·å­è¿‘ä¼¼ ğŸ”¥è€Œå¾—åã€‚ä¸Šé¢çš„ profiling ç»“æœä¹Ÿè½¬æ¢æˆç«ç„°å›¾ï¼Œå¦‚æœå¯¹ç«ç„°å›¾æ¯”è¾ƒäº†è§£å¯ä»¥æ‰‹åŠ¨æ¥æ“ä½œï¼Œä¸è¿‡è¿™é‡Œæˆ‘ä»¬è¦ä»‹ç»ä¸€ä¸ªå·¥å…·ï¼š"),a("code",[s._v("go-torch")]),s._v("ã€‚è¿™æ˜¯ uber å¼€æºçš„ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥ç›´æ¥è¯»å– golang profiling æ•°æ®ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªç«ç„°å›¾çš„ svg æ–‡ä»¶ã€‚")]),s._v(" "),a("h3",{attrs:{id:"å®‰è£…go-torch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®‰è£…go-torch"}},[s._v("#")]),s._v(" å®‰è£…go-torch")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("   go get -v github.com/uber/go-torch\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç«ç„°å›¾ svg æ–‡ä»¶å¯ä»¥é€šè¿‡æµè§ˆå™¨æ‰“å¼€ï¼Œå®ƒå¯¹äºè°ƒç”¨å›¾çš„æœ€ä¼˜ç‚¹æ˜¯å®ƒæ˜¯åŠ¨æ€çš„ï¼šå¯ä»¥é€šè¿‡ç‚¹å‡»æ¯ä¸ªæ–¹å—æ¥ zoom in åˆ†æå®ƒä¸Šé¢çš„å†…å®¹ã€‚")]),s._v(" "),a("p",[s._v("ç«ç„°å›¾çš„è°ƒç”¨é¡ºåºä»ä¸‹åˆ°ä¸Šï¼Œæ¯ä¸ªæ–¹å—ä»£è¡¨ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¸Šé¢ä¸€å±‚è¡¨ç¤ºè¿™ä¸ªå‡½æ•°ä¼šè°ƒç”¨å“ªäº›å‡½æ•°ï¼Œæ–¹å—çš„å¤§å°ä»£è¡¨äº†å ç”¨ CPU ä½¿ç”¨çš„é•¿çŸ­ã€‚ç«ç„°å›¾çš„é…è‰²å¹¶æ²¡æœ‰ç‰¹æ®Šçš„æ„ä¹‰ï¼Œé»˜è®¤çš„çº¢ã€é»„é…è‰²æ˜¯ä¸ºäº†æ›´åƒç«ç„°è€Œå·²ã€‚")]),s._v(" "),a("p",[s._v("go-torch å·¥å…·çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œæ²¡æœ‰ä»»ä½•å‚æ•°çš„è¯ï¼Œå®ƒä¼šå°è¯•ä»"),a("code",[s._v("http://localhost:8080/debug/pprof/profile")]),s._v("è·å– profiling æ•°æ®ã€‚å®ƒæœ‰ä¸‰ä¸ªå¸¸ç”¨çš„å‚æ•°å¯ä»¥è°ƒæ•´ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("-u â€“urlï¼šè¦è®¿é—®çš„ URLï¼Œè¿™é‡Œåªæ˜¯ä¸»æœºå’Œç«¯å£éƒ¨åˆ†")]),s._v(" "),a("li",[s._v("-s â€“suffixï¼špprof profile çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º /debug/pprof/profile")]),s._v(" "),a("li",[s._v("â€“secondsï¼šè¦æ‰§è¡Œ profiling çš„æ—¶é—´é•¿åº¦ï¼Œé»˜è®¤ä¸º 30s")])]),s._v(" "),a("h3",{attrs:{id:"å®‰è£…-flamegraph"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®‰è£…-flamegraph"}},[s._v("#")]),s._v(" å®‰è£… FlameGraph")]),s._v(" "),a("p",[s._v("è¦ç”Ÿæˆç«ç„°å›¾ï¼Œéœ€è¦äº‹å…ˆå®‰è£… FlameGraphå·¥å…·ï¼Œè¿™ä¸ªå·¥å…·çš„å®‰è£…å¾ˆç®€å•ï¼ˆéœ€è¦perlç¯å¢ƒæ”¯æŒï¼‰ï¼Œåªè¦æŠŠå¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶åŠ å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­å³å¯ã€‚")]),s._v(" "),a("ol",[a("li",[s._v("ä¸‹è½½å®‰è£…perlï¼šhttps://www.perl.org/get.html")]),s._v(" "),a("li",[s._v("ä¸‹è½½FlameGraphï¼š"),a("code",[s._v("git clone https://github.com/brendangregg/FlameGraph.git")])]),s._v(" "),a("li",[s._v("å°†"),a("code",[s._v("FlameGraph")]),s._v("ç›®å½•åŠ å…¥åˆ°æ“ä½œç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ä¸­ã€‚")]),s._v(" "),a("li",[s._v("Windowså¹³å°çš„åŒå­¦ï¼Œéœ€è¦æŠŠ"),a("code",[s._v("go-torch/render/flamegraph.go")]),s._v("æ–‡ä»¶ä¸­çš„"),a("code",[s._v("GenerateFlameGraph")]),s._v("æŒ‰å¦‚ä¸‹æ–¹å¼ä¿®æ”¹ï¼Œç„¶ååœ¨"),a("code",[s._v("go-torch")]),s._v("ç›®å½•ä¸‹æ‰§è¡Œ"),a("code",[s._v("go install")]),s._v("å³å¯ã€‚")])]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// GenerateFlameGraph runs the flamegraph script to generate a flame graph SVG. func GenerateFlameGraph(graphInput []byte, args ...string) ([]byte, error) {")]),s._v("\nflameGraph "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findInPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("flameGraphScripts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" flameGraph "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" errNoPerlScript\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" runtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GOOS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"windows"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("runScript")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"perl"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("flameGraph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" graphInput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("runScript")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("flameGraph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" graphInput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"å‹æµ‹å·¥å…·wrk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‹æµ‹å·¥å…·wrk"}},[s._v("#")]),s._v(" å‹æµ‹å·¥å…·wrk")]),s._v(" "),a("p",[s._v("æ¨èä½¿ç”¨https://github.com/wg/wrk æˆ– https://github.com/adjust/go-wrk")]),s._v(" "),a("h3",{attrs:{id:"ä½¿ç”¨go-torch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨go-torch"}},[s._v("#")]),s._v(" ä½¿ç”¨go-torch")]),s._v(" "),a("p",[s._v("ä½¿ç”¨wrkè¿›è¡Œå‹æµ‹:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("go-wrk -n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(" http://127.0.0.1:8080/book/list\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("åœ¨ä¸Šé¢å‹æµ‹è¿›è¡Œçš„åŒæ—¶ï¼Œæ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œ:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("go-torch -u http://127.0.0.1:8080 -t "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("30ç§’ä¹‹åç»ˆç«¯ä¼šåˆå¤å¦‚ä¸‹æç¤ºï¼š"),a("code",[s._v("Writing svg to torch.svg")])]),s._v(" "),a("p",[s._v("ç„¶åæˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€"),a("code",[s._v("torch.svg")]),s._v("å°±èƒ½çœ‹åˆ°å¦‚ä¸‹ç«ç„°å›¾äº†ã€‚"),a("img",{attrs:{src:"assets/pprof3.png",alt:"ç«ç„°å›¾"}}),s._v("ç«ç„°å›¾çš„yè½´è¡¨ç¤ºcpuè°ƒç”¨æ–¹æ³•çš„å…ˆåï¼Œxè½´è¡¨ç¤ºåœ¨æ¯ä¸ªé‡‡æ ·è°ƒç”¨æ—¶é—´å†…ï¼Œæ–¹æ³•æ‰€å çš„æ—¶é—´ç™¾åˆ†æ¯”ï¼Œè¶Šå®½ä»£è¡¨å æ®cpuæ—¶é—´è¶Šå¤šã€‚é€šè¿‡ç«ç„°å›¾æˆ‘ä»¬å°±å¯ä»¥æ›´æ¸…æ¥šçš„æ‰¾å‡ºè€—æ—¶é•¿çš„å‡½æ•°è°ƒç”¨ï¼Œç„¶åä¸æ–­çš„ä¿®æ­£ä»£ç ï¼Œé‡æ–°é‡‡æ ·ï¼Œä¸æ–­ä¼˜åŒ–ã€‚")]),s._v(" "),a("p",[s._v("æ­¤å¤–è¿˜å¯ä»¥å€ŸåŠ©ç«ç„°å›¾åˆ†æå†…å­˜æ€§èƒ½æ•°æ®ï¼š")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("go-torch -inuse_space http://127.0.0.1:8080/debug/pprof/heap\ngo-torch -inuse_objects http://127.0.0.1:8080/debug/pprof/heap\ngo-torch -alloc_space http://127.0.0.1:8080/debug/pprof/heap\ngo-torch -alloc_objects http://127.0.0.1:8080/debug/pprof/heap\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"pprofä¸æ€§èƒ½æµ‹è¯•ç»“åˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pprofä¸æ€§èƒ½æµ‹è¯•ç»“åˆ"}},[s._v("#")]),s._v(" pprofä¸æ€§èƒ½æµ‹è¯•ç»“åˆ")]),s._v(" "),a("p",[a("code",[s._v("go test")]),s._v("å‘½ä»¤æœ‰ä¸¤ä¸ªå‚æ•°å’Œ pprof ç›¸å…³ï¼Œå®ƒä»¬åˆ†åˆ«æŒ‡å®šç”Ÿæˆçš„ CPU å’Œ Memory profiling ä¿å­˜çš„æ–‡ä»¶ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("-cpuprofileï¼šcpu profiling æ•°æ®è¦ä¿å­˜çš„æ–‡ä»¶åœ°å€")]),s._v(" "),a("li",[s._v("-memprofileï¼šmemory profiling æ•°æ®è¦æŠ¥æ–‡çš„æ–‡ä»¶åœ°å€")])]),s._v(" "),a("p",[s._v("æˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©å°†pprofä¸æ€§èƒ½æµ‹è¯•ç›¸ç»“åˆï¼Œæ¯”å¦‚ï¼š")]),s._v(" "),a("p",[s._v("æ¯”å¦‚ä¸‹é¢æ‰§è¡Œæµ‹è¯•çš„åŒæ—¶ï¼Œä¹Ÿä¼šæ‰§è¡Œ CPU profilingï¼Œå¹¶æŠŠç»“æœä¿å­˜åœ¨ cpu.prof æ–‡ä»¶ä¸­ï¼š")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("go "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" -cpuprofile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cpu.prof\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æ¯”å¦‚ä¸‹é¢æ‰§è¡Œæµ‹è¯•çš„åŒæ—¶ï¼Œä¹Ÿä¼šæ‰§è¡Œ Mem profilingï¼Œå¹¶æŠŠç»“æœä¿å­˜åœ¨ cpu.prof æ–‡ä»¶ä¸­ï¼š")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("go "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" -memprofile"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("./mem.prof\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒProfiling ä¸€èˆ¬å’Œæ€§èƒ½æµ‹è¯•ä¸€èµ·ä½¿ç”¨ï¼Œè¿™ä¸ªåŸå› åœ¨å‰æ–‡ä¹Ÿæåˆ°è¿‡ï¼Œåªæœ‰åº”ç”¨åœ¨è´Ÿè½½é«˜çš„æƒ…å†µä¸‹ Profiling æ‰æœ‰æ„ä¹‰ã€‚")]),s._v(" "),a("h2",{attrs:{id:"ç»ƒä¹ é¢˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç»ƒä¹ é¢˜"}},[s._v("#")]),s._v(" ç»ƒä¹ é¢˜")]),s._v(" "),a("ol",[a("li",[s._v("ä½¿ç”¨ginæ¡†æ¶ç¼–å†™ä¸€ä¸ªæ¥å£ï¼Œä½¿ç”¨"),a("code",[s._v("go-wrk")]),s._v("è¿›è¡Œå‹æµ‹ï¼Œä½¿ç”¨æ€§èƒ½è°ƒä¼˜å·¥å…·é‡‡é›†æ•°æ®ç»˜åˆ¶å‡ºè°ƒç”¨å›¾å’Œç«ç„°å›¾ã€‚")])])])}),[],!1,null,null,null);t.default=e.exports}}]);